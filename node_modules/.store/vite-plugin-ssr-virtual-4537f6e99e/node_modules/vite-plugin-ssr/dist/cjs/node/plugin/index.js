"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ssr = exports.plugin = void 0;
exports.default = plugin;
const vite_plugin_glob_1 = __importDefault(require("vite-plugin-glob"));
const utils_1 = require("./utils");
const build_1 = require("./plugins/build");
const dev_1 = require("./plugins/dev");
const manifest_1 = require("./plugins/manifest");
const packageJsonFile_1 = require("./plugins/packageJsonFile");
const removeRequireHookPlugin_1 = require("./plugins/removeRequireHookPlugin");
const generateImportGlobs_1 = require("./plugins/generateImportGlobs");
const config_1 = require("./plugins/config");
const distFileNames_1 = require("./plugins/distFileNames");
const extractStylesPlugin_1 = require("./plugins/extractStylesPlugin");
const extractExportNamesPlugin_1 = require("./plugins/extractExportNamesPlugin");
const suppressRollupWarning_1 = require("./plugins/suppressRollupWarning");
const retrieveDevServer_1 = require("./plugins/retrieveDevServer");
const distLink_1 = require("./plugins/distLink");
// Return as `any` to avoid Plugin type mismatches when there are multiple Vite versions installed
function plugin(vitePluginSsrConfig) {
    const plugins = [
        (0, config_1.setVitePluginSsrConfig)(vitePluginSsrConfig),
        (0, generateImportGlobs_1.generateImportGlobs)(),
        (0, dev_1.dev)(),
        (0, build_1.build)(),
        ...(0, manifest_1.manifest)(),
        (0, packageJsonFile_1.packageJsonFile)(),
        (0, removeRequireHookPlugin_1.removeRequireHookPlugin)(),
        (0, distFileNames_1.distFileNames)(),
        ...(0, extractStylesPlugin_1.extractStylesPlugin)(),
        (0, extractExportNamesPlugin_1.extractExportNamesPlugin)(),
        (0, suppressRollupWarning_1.suppressRollupWarning)(),
        (0, retrieveDevServer_1.retrieveDevServer)(),
        ...(0, distLink_1.distLink)(),
        (0, vite_plugin_glob_1.default)(),
    ];
    return plugins;
}
exports.plugin = plugin;
exports.ssr = plugin;
// Enable `const ssr = require('vite-plugin-ssr/plugin')`
// This lives at the end of the file to ensure it happens after all assignments to `exports`
module.exports = Object.assign(exports.default, exports);
// Error upon wrong usage
Object.defineProperty(plugin, 'apply', {
    enumerable: true,
    get: () => {
        (0, utils_1.assertUsage)(false, 'Make sure to instantiate the `ssr` plugin (`import ssr from "vite-plugin-ssr"`): include `ssr()` instead of `ssr` in the `plugins` list of your `vite.config.js`.');
    },
});
